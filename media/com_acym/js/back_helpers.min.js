"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=new Array(t);a<t;a++)r[a]=e[a];return r}function _iterableToArrayLimit(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var r,i,n,c,o=[],_=!0,s=!1;try{if(n=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;_=!1}else for(;!(_=(r=n.call(a)).done)&&(o.push(r.value),o.length!==t);_=!0);}catch(e){s=!0,i=e}finally{try{if(!_&&null!=a.return&&(c=a.return(),Object(c)!==c))return}finally{if(s)throw i}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var acym_helperFilter={setFieldValue:function(e,t){if(e.hasClass("acym_select2_ajax")){var a=e.attr("data-ctrl");a||(a="dynamics");var r=e.attr("data-task");r||(r="trigger");var i=ACYM_AJAX_URL+"&ctrl="+a+"&task="+r+"&id="+encodeURIComponent(t),n=e.attr("data-params"),c=acym_helper.parseJson(n);i+="&"+jQuery.param(c),jQuery.get(i,function(t){if(t=acym_helper.parseJson(t),Array.isArray(t))t.map(function(t,a){var r=new Option(t.text,t.value,!1,!0);e.append(r).trigger("change")});else{var a=new Option(t.text,t.value,!0,!0);e.append(a).trigger("change")}})}else if("hidden"===e.attr("type")&&void 0!==e.attr("id")&&"delayvar"===e.attr("id").substr(0,8)){var o="second";t>=60&&t%60==0&&(o="minute",(t/=60)>=60&&t%60==0&&(o="hour",(t/=60)>=24&&t%24==0&&(o="day",(t/=24)>=7&&t%7==0&&(o="week",t/=7))));var _=e.attr("id").substr(8);jQuery("#delayvalue"+_).val(t),jQuery("#delaytype"+_).val(o).trigger("change")}else e.is(":checkbox")||void 0!==e.attr("data-switch")?e.is(":checkbox")&&1==t?e.prop("checked",!0):void 0!==e.attr("data-switch")&&e.val()!=t&&e.closest(".medium-3").find(".cell.switch-label").trigger("click"):e.val(t);void 0!==e.attr("data-rs")&&""!==t&&(-1!==t.indexOf("]")?jQuery('input[data-open="'+e.attr("data-rs")+'"]').val(t):jQuery('input[data-open="'+e.attr("data-rs")+'"]').val(moment.unix(t).format("DD MMM YYYY HH:mm")))},setAutomationReload:function(){jQuery("[acym-automation-reload]").each(function(){jQuery(this).on("change",function(){var e=jQuery(this);setTimeout(function(){var t=e.attr("acym-automation-reload"),a=acym_helper.parseJson(t);acym_helper.empty(a.plugin)||(a=[a]),a.forEach(function(e){var t={ctrl:"dynamics",task:"trigger",plugin:e.plugin,trigger:e.trigger};if(e.name&&(t.name=e.name,t.value=jQuery('[name="'+e.name+'"]').val()),e.params)for(var a=0,r=Object.entries(e.params);a<r.length;a++){var i=_slicedToArray(r[a],2),n=i[0],c=i[1];t[n]=c}if(e.paramFields)for(var o=0,_=Object.entries(e.paramFields);o<_.length;o++){var s=_slicedToArray(_[o],2),l=s[0],m=s[1];t[l]=jQuery('[name="'+m+'"]').val()}jQuery.ajax({type:"POST",url:ACYM_AJAX_URL,data:t,success:function(t){var a=jQuery(e.change);a.html(t),["segments","automation"].forEach(function(e){var t=".acym__"+e+"__one__filter.acym__"+e+"__one__filter__classic",r=".acym__"+e+"__inserted__filter input";r+=", .acym__"+e+"__inserted__filter textarea",r+=", .acym__"+e+"__inserted__filter select",a.closest(t).find(r).on("change acym-reloaded",function(){"segments"===e?acym_helperSegment.reloadCounters(a):jQuery.reloadCounters(a)}).trigger("acym-reloaded")}),acym_helperSelect2.setSelect2(),acym_helperSelect2.setAjaxSelect2(),acym_helperTooltip.setTooltip()}})})},100)})})},setToggle:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"acym__automation__one__filter";if(e.length<1)return!0;var a=e.attr("data-acym-toggle-filter");if(void 0===a)return!0;(a=acym_helper.parseJson(a)).forEach(function(a){var r=e.closest(".".concat(t)).find(".".concat(a.class));acym_helperFilter.toggleBlock(e,r,a),e.on("change",function(){acym_helperFilter.toggleBlock(e,r,a)})})},toggleBlock:function(e,t,a){var r=t.find('[name*="[filters]"]');if(a.values.includes(e.val())){if(t.is(":visible"))return;return t.css("display","flex"),void r.attr("name","acym_action".concat(r.attr("name")))}t.hide(),r.attr("name",r.attr("name").replace("acym_action",""))}},acym_helperHeader={setVersionButton:function(){var e=jQuery("#checkVersionButton");e.on("click",function(){var e=jQuery("#checkVersionArea");e.html('<i class="acymicon-circle-o-notch acymicon-spin"></i>');var t=ACYM_AJAX_URL+"&ctrl=update&task=checkForNewVersion";jQuery.get(t,function(t){t=acym_helper.parseJson(t),e.html(t.data.content),jQuery("#acym__check__version__last__check").html(t.data.lastcheck),acym_helperTooltip.setTooltip()})}),1===e.data("check")&&e.trigger("click")}},acym_helperBack={config_get:function(e){var t=ACYM_AJAX_URL+"&ctrl=configuration&task=getAjax&field="+e;return jQuery.ajax({type:"GET",url:t,dataType:"json"})},setDoNotRemindMe:function(){jQuery("#acym__reviews__footer__link").on("click",function(){var e=ACYM_TOGGLE_URL+"&task=setDoNotRemindMe&value="+encodeURIComponent(jQuery(this).attr("title"));jQuery.post(e,function(e){(e=acym_helper.parseJson(e)).error?console.log(e.message):jQuery("#acym__reviews__footer").html(e.message)})}),jQuery(".acym__do__not__remindme, .acym__do__not__remindme__multilingual").on("click",function(){var e=jQuery(this).attr("title");jQuery('[data-news="'+e+'"]').remove();var t=ACYM_TOGGLE_URL+"&task=setDoNotRemindMe&value="+encodeURIComponent(e);jQuery.post(t,function(e){(e=acym_helper.parseJson(e)).error?console.log(e.message):location.reload()})}),jQuery("#acym__multilingual__reminder").on("click",function(){localStorage.setItem("acyconfiguration","languages")})}},acym_helperJoomla={setWidthJoomlaContent:function(){var e=jQuery("#acym__joomla__left-menu");if(e){var t=e.width();jQuery(window).width()<640?(t=0,e.css({display:"none"})):e.css({display:"block"}),jQuery("#acym_content, .acym_no_foundation").css({width:"calc(100% - "+t+"px)","margin-left":t+"px"}),jQuery("#system-message-container").css({"margin-left":t+15+"px"})}},setJoomlaLeftMenu:function(){var e=jQuery("#acym__joomla__left-menu"),t=jQuery("#acym__joomla__left-menu--toggle"),a=jQuery("#acym__joomla__left-menu a span"),r=jQuery("#acym__joomla__left-menu--toggle i");jQuery(".btn-subhead").hide(),"none"!=t.css("display")&&(e.hasClass("collapsed")?(a.hide(),e.css({width:"34px"}),r.removeClass("acymicon-keyboard_arrow_left").addClass("acymicon-keyboard_arrow_right")):(a.show(),e.css({width:"210px"}),r.removeClass("acymicon-keyboard_arrow_right").addClass("acymicon-keyboard_arrow_left")),acym_helperJoomla.setWidthJoomlaContent(),t.off("click").on("click",function(){e.hasClass("collapsed")?(e.removeClass("collapsed"),a.show(),e.css({width:"210px"}),r.removeClass("acymicon-keyboard_arrow_right").addClass("acymicon-keyboard_arrow_left"),acym_helper.setCookie("menuJoomla","",365)):(e.addClass("collapsed"),a.hide(),e.css({width:"34px"}),r.removeClass("acymicon-keyboard_arrow_left").addClass("acymicon-keyboard_arrow_right"),acym_helper.setCookie("menuJoomla","collapsed",365)),acym_helperJoomla.setWidthJoomlaContent()})),jQuery(".btn-navbar").off("click").on("click",function(){e.hide()}),jQuery("#acym__joomla__left-menu--show").off("click").on("click",function(){var t=jQuery(".btn-navbar");t.hasClass("collapsed")||(jQuery(".nav-collapse").css("height","0px").removeClass("in"),t.removeClass("collapsed")),e.toggle()}),jQuery(window).on("resize",function(){window.innerWidth<950&&!e.hasClass("collapsed")&&t.trigger("click"),acym_helperJoomla.setWidthJoomlaContent()})}},acym_helperMailer={setTestCredentialsSendingMethods:function(){jQuery(".acym__configuration__sending__method-test").off("click").on("click",function(){var e=this.getAttribute("sending-method-id");if(void 0===e)return!1;var t=jQuery(this).closest(".acym__sending__methods__credentials__test").find(".acym__configuration__sending__method-icon"),a=jQuery(this).closest(".acym__sending__methods__credentials__test").find(".acym__configuration__sending__method-test__message");t.removeClass("acym__color__red acym__color__green").addClass("acymicon-circle-o-notch acymicon-spin"),a.html("");for(var r={ctrl:"configuration",task:"testCredentialsSendingMethod",sendingMethod:this.getAttribute("sending-method-id")},i=jQuery('[name^="config['.concat(e,'"]')),n=0;n<i.length;n++){var c=i[n];"radio"==c.getAttribute("type")&&c.checked?r[c.getAttribute("name")]=c.value:"radio"!=c.getAttribute("type")&&(r[c.getAttribute("name")]=c.value)}acym_helper.post(ACYM_AJAX_URL,r).then(function(e){var r;r=e.error?"acymicon-times-circle acym__color__red":"acymicon-check-circle acym__color__green",t.removeClass("acymicon-circle-o-notch acymicon-spin acymicon-check-circle acymicon-times-circle"),t.addClass(r),a.html(e.message)})})},setButtonCopyFromPlugin:function(){jQuery(".acym__configuration__copy__mail__settings").off("click").on("click",function(){var e=jQuery(this).closest(".acym__sending__methods__copy__data").find(".acym__configuration__sending__method-icon");e.addClass("acymicon-circle-o-notch acymicon-spin");var t={plugin:jQuery(this).attr("acym-data-plugin"),method:jQuery(this).attr("acym-data-method")},a=ACYM_AJAX_URL+"&ctrl=configuration&task=copySettingsSendingMethod";acym_helper.post(a,t).then(function(e){if(e.error)return acym_helperNotification.addNotification(e.message,"error"),!1;for(var t=0,a=Object.entries(e.data);t<a.length;t++){var r=_slicedToArray(a[t],2),i=r[0],n=r[1],c=jQuery('[name="config['.concat(i,']"]'));0!==c.length&&(void 0!==c.attr("data-switch")&&c.val()!=n?c.closest(".switch").find(".switch-label").trigger("click"):"radio"===c.attr("type")?(c=jQuery('[name="config['.concat(i,']"][value="').concat(n.toLowerCase(),'"]'))).length>0&&c.trigger("click"):c.val(n).trigger("change"))}}).always(function(t){e.removeClass("acymicon-circle-o-notch acymicon-spin")})})},setSynchroExistingUsers:function(){jQuery(".acym__configuration__sending__synch__users").off("click").on("click",function(){var e=this.getAttribute("sending-method-id");if(void 0===e)return!1;var t=jQuery(this).closest(".acym__sending__methods__synch").find(".acym__configuration__sending__method-icon"),a=jQuery(this).closest(".acym__sending__methods__synch").find(".acym__configuration__sending__method-synch__message");t.removeClass("acym__color__red acym__color__green").addClass("acymicon-circle-o-notch acymicon-spin"),a.html("");var r={ctrl:"configuration",task:"synchronizeExistingUsers",sendingMethod:e};acym_helper.post(ACYM_AJAX_URL,r).then(function(e){var r;r=e.error?"acymicon-times-circle acym__color__red":"acymicon-check-circle acym__color__green",t.removeClass("acymicon-circle-o-notch acymicon-spin"),t.addClass(r),a.html(e.message)})})},displayAuth2Params:function(){var e=jQuery("#smtp_host");0!==e.length&&(jQuery("#smtp_type").on("change",function(){acym_helperMailer.handleAuth2ParamsAppearance()}),e.on("keyup",function(){acym_helperMailer.handleAuth2ParamsAppearance()}),acym_helperMailer.handleAuth2ParamsAppearance())},handleAuth2ParamsAppearance:function(){var e=["smtp-mail.outlook.com","smtp.office365.com"],t=[].concat(["smtp.gmail.com"],e),a=jQuery("#acym__sending__methods__one__settings__type"),r=jQuery(".acym__default_auth_sending_params"),i=jQuery(".acym__oauth2_sending_params"),n=jQuery("#smtp_tenant_container"),c=jQuery("#smtp_host").val().toLowerCase().trim();if(!t.includes(c))return a.hide(),r.show(),void i.hide();a.show(),"oauth"===jQuery("#smtp_type").val()?(r.hide(),i.show(),e.includes(c)?n.show():n.hide()):(r.show(),i.hide())},acymailerAddDomains:function(){var e=jQuery("#acym__configuration__acymailer__add__error");jQuery("#acym__configuration__sending__method-addDomain").off("click").on("click",function(){e.hide();var t=jQuery("#acymailer_domain").val().trim();if(!acym_helper.empty(t)){var a={oneDomain:t,ctrl:"dynamics",task:"trigger",plugin:"plgAcymAcymailer",trigger:"ajaxAddDomain"},r=document.querySelector("#acym__configuration__sending__method_add_domain-wait");r.classList.remove("is-hidden"),acym_helper.post(ACYM_AJAX_URL,a).then(function(t){if(t.error)return jQuery("#acym__acymailer__unverifiedDomains").hide(),jQuery("#acym__configuration__acymailer__add__error__message").text(t.message),e.css("display","flex"),void r.classList.add("is-hidden");location.reload()})}})},displayCnameRecord:function(){jQuery("#acym_wrapper").on("click",".acym__sending__methods__unverifiedDomain-icon",function(){var e=jQuery(this).closest(".acym__sending__methods__container__oneUnverifiedDomain").find(".acym__sending__methods__unverifiedDomain"),t=acym_helper.parseJson(e[0].getAttribute("data-acym-cname")),a=jQuery("#acym__configuration__sending__method__cnameTable__container"),r=document.querySelectorAll(".cname-value"),i=document.querySelectorAll(".cname-name");for(var n in t)r[n].innerHTML=t[n].value,i[n].innerHTML=t[n].name;0===jQuery(".domain_selected").length?(a.slideToggle(),jQuery(this).addClass("domain_selected")):jQuery(this).hasClass("domain_selected")?(a.slideToggle(),jQuery(this).removeClass("domain_selected")):(jQuery(".acym__sending__methods__unverifiedDomain-icon").removeClass("domain_selected"),jQuery(this).addClass("domain_selected"))}),jQuery(".cname-name, .cname-value").on("click",function(){var e=document.createRange();e.selectNode(this),window.getSelection().removeAllRanges(),window.getSelection().addRange(e)})},deleteDomain:function(){jQuery(".acym__config__acymailer__domain--delete").off("click").on("click",function(){var e=this;if(confirm(ACYM_JS_TXT.ACYM_ARE_YOU_SURE)){this.classList.remove("acymicon-delete"),this.classList.add("acymicon-circle-o-notch","acymicon-spin");var t={oneDomain:jQuery(this).attr("acym-data-domain").trim(),ctrl:"dynamics",task:"trigger",plugin:"plgAcymAcymailer",trigger:"onAcymDeleteDomain"};acym_helper.post(ACYM_AJAX_URL,t).then(function(t){if(t.error)return e.classList.add("acymicon-delete"),e.classList.remove("acymicon-circle-o-notch","acymicon-spin"),void acym_helperNotification.addNotification(t.message,"error",!0);jQuery(e).closest(".acym__listing__row").remove(),jQuery(".acym__config__acymailer__status__icon.acymicon-access_time").length||jQuery(".acym__config__acymailer__warning").remove()})}})},domainSuggestion:function(){var e=jQuery("#acym__acymailer__unverifiedDomains"),t=jQuery("#acymailer_domain"),a=jQuery(".acym__acymailer__oneSuggestion"),r=jQuery("#acymailer_domain_error");e.hide(),t.off("click").on("click",function(){e.toggle(),e.is(":visible")?r.hide():r.show()}),jQuery.each(a,function(){jQuery(this).on("mouseenter",function(){jQuery(this).addClass("acym__acymailer__suggestion_selected")}),jQuery(this).on("mouseleave",function(){jQuery(this).removeClass("acym__acymailer__suggestion_selected")}),jQuery(this).off("click").on("click",function(){t.val(jQuery(this).html().trim()),e.hide()})})},updateStatus:function(){jQuery("#acym__config__acymailer__update-domain-status").on("click",function(){jQuery(".notValidated").replaceWith('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),acym_helper.get(ACYM_AJAX_URL,{sendingMethod:this.getAttribute("sending-method-id"),ctrl:"dynamics",task:"trigger",plugin:"plgAcymAcymailer",trigger:"ajaxCheckDomain"}).then(function(e){if(e.error){acym_helperNotification.addNotification(e.message,"error",!0);var t=jQuery('div[acym-data-domain="'.concat(e.data.domain,'"]'));return t.parent().find(".acymicon-spin").replaceWith('<i class="acym__config__acymailer__status__icon acymicon-remove acym__color__red notValidated"></i>'),void t.find(".acym__tooltip__text").html(e.message)}var a="",r="";Object.entries(e.data.domains).forEach(function(e){var t=_slicedToArray(e,2),i=t[0];switch(t[1].status){case"SUCCESS":a="acymicon-check-circle acym__color__green",r=ACYM_JS_TXT.ACYM_VALIDATED;break;case"FAILED":a="acymicon-remove acym__color__red notValidated",r=ACYM_JS_TXT.ACYM_APPROVAL_FAILED;break;default:a="acymicon-access_time acym__color__orange notValidated",r=ACYM_JS_TXT.ACYM_PENDING}var n=jQuery('div[acym-data-domain="'.concat(i,'"]'));n.find(".acymicon-spin").replaceWith('<i class="acym__config__acymailer__status__icon '+a+'"></i>'),n.find(".acym__tooltip__text").html(r)})})})}},acym_helperNotification={setNotificationCenter:function(){acym_helperNotification.removeNotifications();var e=jQuery(".acym__header__notification");e.find("i").hasClass("acymicon-check-circle")&&setTimeout(function(){e.find("> i").attr("class","acymicon-bell-o"),e.find(".acym__tooltip__text").remove(),e.removeAttr("data-acym-tooltip").removeAttr("data-acym-tooltip-position").removeClass("acym__header__notification__button__success acym__header__notification__pulse")},8e3),e.off("click").on("click",function(){acym_helperNotification.readFullNotification();var t=jQuery(this),a=jQuery(".acym__header__notification__center"),r=t.offset(),i=r.left-a.width()+t.width()+"px",n=r.top+t.height()+10+"px";a.css({top:n,left:i}).addClass("acym__header__notification__center__visible");var c=ACYM_AJAX_URL+"&ctrl=configuration&task=markNotificationRead";jQuery.post(c,function(e){jQuery(".acym__header__notification").removeClass("acym__header__notification__pulse acym__header__notification__button__success acym__header__notification__button__info acym__header__notification__button__warning acym__header__notification__button__error").find("> i").attr("class","acymicon-bell-o")}),e.off("click").on("click",function(e){if(jQuery(e.target).hasClass("acym__header__notification__center__visible")||jQuery(e.target).closest(".acym__header__notification__center__visible").length>0)return!0;acym_helperNotification.removeNotificationsCenter()}),setTimeout(function(){jQuery(window).off("click").on("click",function(e){if(jQuery(e.target).hasClass("acym__header__notification__center__visible")||jQuery(e.target).closest(".acym__header__notification__center__visible").length>0)return!0;acym_helperNotification.removeNotificationsCenter()})},100)}),jQuery(".acym__message__close").off("click").on("click",function(){var e=jQuery(this),t=e.attr("data-id");if(void 0!==t&&0!=t){var a=ACYM_AJAX_URL+"&ctrl=configuration&task=markNotificationRead&id="+t;jQuery.post(a,function(t){e.closest(".acym__message").remove()})}else e.closest(".acym__message").remove()})},removeNotifications:function(){jQuery(".acym__header__notification__one__delete, .acym__header__notification__toolbox__remove").off("click").on("click",function(){var e=jQuery(this).hasClass("acym__header__notification__toolbox__remove")?"all":jQuery(this).attr("data-id"),t=ACYM_AJAX_URL+"&ctrl=configuration&task=removeNotification&id="+e;jQuery.post(t,function(e){(e=acym_helper.parseJson(e)).error?console.log(e.message):(jQuery(".acym__header__notification__center").html(e.data.html),jQuery(".acym__header__notification").find("> i").attr("class","acymicon-bell-o"),acym_helperNotification.removeNotifications())})})},removeNotificationsCenter:function(){jQuery(".acym__header__notification__center").removeClass("acym__header__notification__center__visible"),jQuery(window).off("click"),acym_helperNotification.setNotificationCenter()},addNotification:function(e,t,a){void 0===a&&(a=!1),a&&jQuery(".acym__message").remove(),void 0!==t&&-1!=jQuery.inArray(t,["success","warning","error"])||(t="info");var r=acym_helperNotification.addHeaderNotification(e,t);jQuery("#acym_header").after(r);var i=ACYM_AJAX_URL+"&ctrl=configuration&task=addNotification&message="+e+"&level="+t;jQuery.post(i,function(e){(e=acym_helper.parseJson(e)).error?console.log(e.message):(jQuery(".acym__header__notification").replaceWith(e.data.notificationCenter),acym_helperNotification.setNotificationCenter())})},addHeaderNotification:function(e,t){return'<div class="acym__message grid-x acym__message__'+t+'"><div class="cell auto"><p>'+e+'</p></div><i data-id="0" class="cell shrink acym__message__close acymicon-remove"></i></div>'},readFullNotification:function(){jQuery(".acym__header__notification__one").off("click").on("click",function(){var e=jQuery(this).find(".acym__header__notification__message"),t=e.attr("data-acym-full");if(acym_helper.empty(t))return!0;var a=e.html();e.html(t),e.attr("data-acym-full",a)})}},acym_helperSegment={filterRebuilt:!0,blocksRebuilt:!0,ajaxCalls:{},globalAjaxCall:"",reloadCounters:function(e){if(acym_helperSegment.filterRebuilt){var t=jQuery(e).closest(".acym__segments__inserted__filter").attr("data-and"),a=jQuery(e).closest("[data-filter-number]").attr("data-filter-number"),r=ACYM_AJAX_URL+"&page=acymailing_segments&ctrl=segments&task=countResults&and="+t+"&or="+a;void 0!==this.ajaxCalls[t]&&"function"==typeof this.ajaxCalls[t].abort&&this.ajaxCalls[t].abort(),jQuery("#results_"+t).find(".acym__segments__edit__filter-results").html('<i class="acymicon-circle-o-notch acymicon-spin"></i>');var i=jQuery(e).closest("#acym_form").serialize()+"&page=acymailing_segments&ctrl=segments&task=countResults&and="+t+"&or="+a;this.ajaxCalls[t]=jQuery.post(r,i).done(function(e){e=acym_helper.parseJson(e),jQuery("#results_"+t).find(".acym__segments__edit__filter-results").html(e.error?ACYM_JS_TXT.ACYM_ERROR:e.message)}).fail(function(){jQuery("#results_"+t).find(".acym__segments__edit__filter-results").html(ACYM_JS_TXT.ACYM_ERROR)}),this.reloadGlobalCounter()}},reloadGlobalCounter:function(){if(acym_helperSegment.blocksRebuilt){var e="";if(jQuery("#acym__campaigns__segment").length>0)e=jQuery("#acym__campaigns__segment__edit-user-count");else{var t=jQuery(".acym__segments__edit__filters__no-users");if(e=jQuery(".acym__segments__edit__filters__total"),0===jQuery("[name^=acym_action]").length)return t.show(),void e.hide();t.hide(),e.show()}""!==this.globalAjaxCall&&"function"==typeof this.globalAjaxCall.abort&&(this.globalAjaxCall.abort(),this.globalAjaxCall="");var a=jQuery('input[value="exclude"]:checked').length?1:0,r=jQuery(".acym__segments__group__filter"),i=ACYM_AJAX_URL+"&page=acymailing_segments&ctrl=segments&task=countResultsTotal&exclude="+a,n=r.closest("#acym_form").serialize()+"&page=acymailing_segments&ctrl=segments&task=countResultsTotal&exclude="+a;e.html('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),this.globalAjaxCall=jQuery.post(i,n).done(function(t){t=acym_helper.parseJson(t),e.html(t.error?ACYM_JS_TXT.ACYM_ERROR:t.message)}).fail(function(){e.html(ACYM_JS_TXT.ACYM_ERROR)})}},refreshFilterProcess:function(){this.setSelectFilters("classic"),this.setAddFilter(),this.setDeleteFilter(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSelect2.setAjaxSelect2(),this.setAddFilterOr()},setSelectFilters:function(e){var t=jQuery("#acym__campaigns__segment").length>0,a=jQuery("#acym__segments__edit__info__options");if(a.length){var r=acym_helper.parseJson(a.val());jQuery(".acym__segments__select__"+e+"__filter").off("change").on("change",function(){t&&jQuery('[name="segment_selected"]').val("");var e=jQuery("#acym__segments__filters__count__and"),a="";0!==parseInt(e.val())&&(a='<span class="cell acym_vcenter acym__segments__delete__one__filter"><i class="acymicon-delete"></i>'.concat(ACYM_JS_TXT.ACYM_DELETE_THIS_FILTER,"</span>")),e.val(parseInt(e.val())+1);var i=acym_helperSegment.getSeeUserModalButton(jQuery(this),e.val());jQuery(this).parent().parent().find(".acym__segments__inserted__filter").remove();var n=r[jQuery(this).val()].replace(/__numor__/g,jQuery(this).closest(".acym__segments__group__filter").attr("data-filter-number"));n=n.replace(/__numand__/g,e.val());var c=t?"medium-9":"medium-6";jQuery(this).parent().after('<div data-and="'+e.val()+'" class="cell grid-x grid-margin-x grid-margin-y acym__segments__inserted__filter margin-top-1 margin-left-2 acym_vcenter"><div class="cell grid-x '+c+' grid-margin-x grid-margin-y">'+n+'</div><span class="countresults margin-bottom-1 cell auto grid-x" id="results_'+e.val()+'"><span class="acym__segments__edit__filter-results cell"></span>'+a+i+"</span></div>"),acym_helperSelect2.setSelect2(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperTooltip.setTooltip(),acym_helperFilter.setAutomationReload(),jQuery(document).foundation(),jQuery(document).trigger("acym__modal__users__summary__ready"),jQuery(".switch-label").off("click").on("click",function(){var e=jQuery('input[data-switch="'+jQuery(this).attr("for")+'"]');e.attr("value",1-e.attr("value"))});var o=jQuery(this).closest(".acym__segments__one__filter").find(".acym__automation__filters__operator__dropdown"),_=jQuery(this).closest(".acym__segments__one__filter").find(".acym__automation__filters__fields__dropdown");o.on("change",function(){_.trigger("change")}),_.on("change",function(){var e=jQuery(this).closest(".acym__segments__inserted__filter"),t=e.find('[data-filter-field="'+jQuery(this).val()+'"]'),a=e.find(".acym__automation__filters__fields__select"),r=e.find(".acym__automation__filter__regular-field");t.length>0&&("="===o.val()||"!="===o.val())?(r.attr("name",r.attr("name").replace("acym_action","")).hide(),a.each(function(e){jQuery(this).attr("name",jQuery(this).attr("name").replace("acym_action","")),jQuery(this).closest(".acym__automation__one-field").hide()}),-1===t.attr("name").indexOf("acym_action")&&t.attr("name","acym_action"+t.attr("name")),t.closest(".acym__automation__one-field").show()):(-1===r.attr("name").indexOf("acym_action")&&r.attr("name","acym_action"+r.attr("name")),a.length>0&&a.each(function(){jQuery(this).attr("name",jQuery(this).attr("name").replace("acym_action","")),jQuery(this).closest(".acym__automation__one-field").hide()}),r.show())}).trigger("change"),jQuery(this).closest(".acym__segments__one__filter.acym__segments__one__filter__classic").find(".acym__segments__inserted__filter input, .acym__segments__inserted__filter select").on("change",function(){acym_helperSegment.reloadCounters(this)}),0==jQuery(this).val()?acym_helperSegment.reloadGlobalCounter(jQuery(this).closest(".acym__segments__group__filter")):acym_helperSegment.reloadCounters(jQuery(this).closest(".acym__segments__one__filter.acym__segments__one__filter__classic").find(".acym__segments__inserted__filter input, .acym__segments__inserted__filter select, .acym__segments__inserted__filter textarea"));var s=jQuery(this).closest(".acym__segments__one__filter").find("[data-acym-toggle-filter]");acym_helperFilter.setToggle(s,"acym__segments__one__filter"),jQuery(document).foundation(),jQuery(".reveal-overlay").appendTo("#acym_form"),acym_helperSegment.refreshFilterProcess()})}},setAddFilter:function(){jQuery(".acym__segments__add-filter").off("click").on("click",function(){if(0===jQuery(this).closest(".acym__segments__group__filter").find(".acym__segments__one__filter").length){var e=jQuery("#acym__segments__and__example").clone().removeAttr("id");e.find(".acym__automation__and").remove(),jQuery(this).parent().before(e.show())}else jQuery(this).parent().before(jQuery("#acym__segments__and__example").clone().removeAttr("id").show());var t=jQuery(this).parent().prev();t.addClass("acym__segments__one__filter__"+jQuery(this).attr("data-filter-type")),t.find(".acym__segments__and__example__"+jQuery(this).attr("data-filter-type")+"__select").show().find("select").addClass("acym__select").select2({theme:"foundation",width:"100%"}),acym_helperSegment.refreshFilterProcess()})},setDeleteFilter:function(){jQuery(".acym__segments__delete__one__filter").off("click").on("click",function(){jQuery(this).closest(".acym__segments__one__filter").remove(),acym_helperSegment.reloadGlobalCounter()}),jQuery(".acym__segments__delete__one__or").off("click").on("click",function(){jQuery(this).closest(".acym__segments__or__container").remove(),acym_helperSegment.reloadGlobalCounter()})},rebuildFilters:function(){var e=jQuery("#acym__segments__filters");if(""!==e.val()){var t=acym_helper.parseJson(e.val()),a=0,r=parseInt(Object.keys(t).slice(-1)[0]);acym_helperSegment.blocksRebuilt=!1,jQuery.each(t,function(e,t){0!==a&&jQuery(".acym__automation__filters__or").trigger("click");var i=0,n=Object.keys(t).slice(-1)[0];jQuery.each(t,function(t,c){0!==i&&jQuery('.acym__segments__group__filter[data-filter-number="'+a+'"]').find(".acym__segments__add-filter[data-filter-type]").trigger("click"),acym_helperSegment.filterRebuilt=!1,jQuery.each(c,function(i,c){var o=jQuery('.acym__segments__group__filter[data-filter-number="'+a+'"]').find(".acym__segments__select__classic__filter").last();o.val(i),o.trigger("change");var _=Object.keys(c);jQuery.each(_,function(o){var s=_[o],l=c[_[o]],m=jQuery('[name="acym_action[filters]['+a+"]["+jQuery("#acym__segments__filters__count__and").val()+"]["+i+"]["+s+']"]');acym_helperFilter.setFieldValue(m,l),o===_.length-1&&(acym_helperSegment.filterRebuilt=!0,n===t&&r===parseInt(e)&&(acym_helperSegment.blocksRebuilt=!0)),m.trigger("change")})}),i++}),a++}),this.refreshFilterProcess()}},setAddFilterOr:function(){jQuery(".acym__automation__filters__or").off("click").on("click",function(){var e=jQuery("#acym__automation__filters__count__or");e.val(parseInt(e.val())+1),jQuery(this).before(jQuery("#acym__automation__or__example").html());var t=jQuery(this).prev();t.find(".acym__segments__group__filter").attr("data-filter-number",e.val()),acym_helperSegment.refreshFilterProcess(),t.find("button[data-filter-type]").trigger("click"),"classic"===jQuery(this).attr("data-filter-type")&&acym_helperSegment.reloadGlobalCounter(t)})},getSeeUserModalButton:function(e,t){var a="acym__segments__see-users__".concat(t),r=jQuery("#acym__segment__see-users__example").clone(),i=jQuery("#acym__segments__see-users").closest(".reveal-overlay").clone();r.find('[data-open="acym__segments__see-users"]').attr("data-open",a),i.find("#acym__segments__see-users").attr("id",a);var n={ctrl:"segments",task:"usersSummary",and:t,or:e.closest("[data-filter-number]").attr("data-filter-number")};i.find("[acym-data-query]").attr("acym-data-query",JSON.stringify(n));var c=r.html()+i[0].outerHTML;return'<span class="cell shrink acym__segments__see-users">'.concat(c,"</span>")}},acym_helperSelect2={initJsSelect2:function(){this.setSelect2(),this.setAjaxSelect2(),this.setSelect2Email(),this.setSelect2ChooseTagsGlobal()},setSelect2:function(){jQuery(".acym__select:not([acym-data-infinite])").select2({theme:"foundation",width:"100%"}),jQuery(".acym__select[acym-data-infinite]").select2({theme:"foundation",width:"100%",minimumResultsForSearch:1/0}),jQuery(".intext_select").select2({theme:"foundation",minimumResultsForSearch:1/0})},setAjaxSelect2:function(){jQuery(".acym_select2_ajax").each(function(){var e=jQuery(this).attr("data-placeholder");e||(e="- - -");var t=jQuery(this).attr("data-ctrl");t||(t="dynamics");var a=jQuery(this).attr("data-task");a||(a="trigger");var r=jQuery(this).attr("acym-data-default"),i={ctrl:t,task:a},n=jQuery(this).attr("data-params");if(n){var c=acym_helper.parseJson(n);Object.assign(i,c)}var o=jQuery(this).attr("data-min");o||(o=3),jQuery(this).select2({theme:"foundation",ajax:{url:ACYM_AJAX_URL,dataType:"json",delay:250,data:function(e){return i.search=e.term,i},processResults:function(e){var t=[];return void 0===r||""!==i.search&&void 0!==i.search||t.push({id:0,text:r}),e&&jQuery.each(e,function(e,a){t.push({id:a[0],text:a[1]})}),{results:t}},cache:!0},minimumInputLength:o,width:"100%",allowClear:!0,placeholder:e});var _=jQuery(this).attr("data-selected");if(void 0!==_){var s=ACYM_AJAX_URL+"&ctrl="+t+"&task="+a+"&id="+encodeURIComponent(_),l=jQuery(this);void 0!==i.plugin&&void 0!==i.trigger&&(s+="&plugin=".concat(i.plugin,"&trigger=").concat(i.trigger)),jQuery.get(s,function(e){if(e=acym_helper.parseJson(e),Array.isArray(e))e.map(function(e,t){var a=new Option(e.text,e.value,!1,!0);l.append(a)});else{var t=new Option(e.text,e.value,!1,!1);l.append(t)}})}})},setSelect2Email:function(){var e=jQuery(".acym__multiselect__email"),t={ctrl:"campaigns",task:"searchTestReceiversAjax"};e.select2({width:"100%",placeholder:e.attr("placeholder"),tags:!0,theme:"foundation",tokenSeparators:[" ",",",";"],createTag:function(e){var t=jQuery.trim(e.term);return acym_helper.emailValid(t)?{id:t,text:t}:null},ajax:{url:ACYM_AJAX_URL,dataType:"json",delay:250,data:function(e){return t.search=e.term,t},processResults:function(t){var a=[];return t&&jQuery.each(t,function(t,r){var i=r[0];e.length>1&&(i=r[1]),a.push({id:i,text:r[1]})}),{results:a}}},minimumInputLength:3})},setSelect2ChooseTagsGlobal:function(){var e=jQuery("#acym__tags__field"),t=e.attr("placeholder");e.select2({width:"100%",placeholder:t,tags:!0,theme:"foundation",tokenSeparators:[" "],createTag:function(e){var t=jQuery.trim(e.term);return""===t?null:{id:"acy_new_tag_"+t,text:t,newTag:!0}}})}},acym_helperStats={setLineChartOpenTimeWeek:function(){if(null!==document.getElementById("acym__stats__global__open-time__data")){var e=document.getElementById("acym__stats__global__open-time__data").value;if(void 0!==e){e=acym_helper.parseJson(e);var t,a,r={sunday:[],other:[]},i={sunday:[],other:[]},n={0:ACYM_JS_TXT.ACYM_SUNDAY,1:ACYM_JS_TXT.ACYM_MONDAY,2:ACYM_JS_TXT.ACYM_TUESDAY,3:ACYM_JS_TXT.ACYM_WEDNESDAY,4:ACYM_JS_TXT.ACYM_THURSDAY,5:ACYM_JS_TXT.ACYM_FRIDAY,6:ACYM_JS_TXT.ACYM_SATURDAY},c={1:"3h",2:"6h",3:"9h",4:"12h",5:"15h",6:"18h",7:"21h"};e.map(function(e,t){var a=0===t?"sunday":"other";e.map(function(e,o){0===o?r[a].push(n[t]):r[a].push(c[o]),i[a].push(e)})}),t=r.other.concat(r.sunday),a=i.other.concat(i.sunday);new Chart(document.getElementById("chartjs-0"),{type:"line",data:{labels:t,datasets:[{label:ACYM_JS_TXT.ACYM_OPEN_PERCENTAGE,data:a,fill:!1,borderColor:"rgb(0, 165, 255)",lineTension:.1}]},options:{responsive:!0,legend:{display:!1},maintainAspectRatio:!1,tooltips:{backgroundColor:"#fff",borderWidth:2,borderColor:"#303e46",titleFontSize:16,titleFontColor:"#303e46",bodyFontColor:"#303e46",bodyFontSize:14,displayColors:!1},scales:{yAxes:[{gridLines:{display:!1},ticks:{display:!0,fontColor:"#0a0a0a"}}],xAxes:[{gridLines:{display:!1},ticks:{display:!0,fontSize:14,fontColor:"#0a0a0a"}}]}}})}}}};