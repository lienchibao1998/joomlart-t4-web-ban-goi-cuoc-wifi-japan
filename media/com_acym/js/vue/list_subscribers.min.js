jQuery(function(e){if(e("#requireConfirmation").length>0){let s=20,r=s,t=500;const i=["email","name"],c=(e,s,r)=>e.filter(e=>-1!==r.map(r=>-1!==e[r].toLowerCase().indexOf(s.toLowerCase())).indexOf(!0));new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__list__settings__subscribers",data:{subscribed:[],displayedSubscribers:[],columnOrderSelected:"",columnOrderSelectedCss:"id",busy:!1,listid:0,total:0,loading:!0,searchSubscribers:"",requireConfirmation:0,users_ordering:"id",users_ordering_sort_order:"desc"},mounted:function(){document.querySelector('.acym__list__settings__subscribers__search input[type="text"]').addEventListener("keydown",function(e){if("Enter"===e.key)return e.preventDefault(),!1}),this.requireConfirmation=document.getElementById("requireConfirmation").value;let e=document.getElementById("acym__list__settings__subscribers__listing");null!==e&&(e.style.display="flex"),this.subscribed=acym_helper.parseJson(document.getElementById("subscribers_subscribed").value),this.listid=document.querySelector('[name="listId"]').value,this.total=this.subscribed.length,this.displayedSubscribers=this.subscribed.slice(0,r),this.total<t?this.loading=!1:this.getAllSubscribers()},methods:{loadMoreSubscriber(){r+=s,this.displayedSubscribers=""===this.searchSubscribers?this.subscribed.slice(0,r):c(this.subscribed,this.searchSubscribers,i)},getAllSubscribers(){let r=document.querySelector('[name="ctrl"]').value;e.get(ACYM_AJAX_URL+"&ctrl="+r+"&task=loadMoreSubscribers&offset="+this.total+"&perCalls="+t+"&listId="+this.listid+"&orderBy="+this.users_ordering+"&orderByOrdering="+this.users_ordering_sort_order,e=>{if(0===(e=acym_helper.parseJson(e)).data.subscribers.length)return this.loading=!1,!0;let r=e.data.subscribers.length;return this.subscribed=this.subscribed.concat(e.data.subscribers),this.total+=r,this.displayedSubscribers=this.subscribed.slice(0,s),r<t?(this.loading=!1,!0):(this.getAllSubscribers(),!0)})},doSearch(){""===this.searchSubscribers?(r=s,this.displayedSubscribers=this.subscribed.slice(0,r)):this.displayedSubscribers=c(this.subscribed,this.searchSubscribers,i)},unsubscribeUser(s){let r=e("#acym_form");e('[name="acym__entity_select__selected"]').val(""),e('[name="acym__entity_select__unselected"]').val("["+s+"]"),r.find('[name="task"]').attr("value","saveSubscribers"),r.submit()},getAgainSubscribers(){this.subscribed=[],this.displayedSubscribers=[],this.total=0,this.loading=!0,this.getAllSubscribers()},orderByTable(e){if(this.columnOrderSelected==e)return this.displayedSubscribers.sort((e,s)=>{const r=String(e[this.columnOrderSelected]).toLowerCase(),t=String(s[this.columnOrderSelected]).toLowerCase();return r>t?-1:r<t?1:0}),void(this.columnOrderSelected="");this.columnOrderSelected=e,this.columnOrderSelectedCss=e,this.displayedSubscribers.sort((e,s)=>{const r=String(e[this.columnOrderSelected]).toLowerCase(),t=String(s[this.columnOrderSelected]).toLowerCase();return r<t?-1:r>t?1:0})}},watch:{searchSubscribers(){this.doSearch()},users_ordering(){this.getAgainSubscribers()}}})}});