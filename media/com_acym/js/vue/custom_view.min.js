jQuery(document).on("acym_plugins_installed_loaded",function(){let e=[],t=jQuery("[acym-data-plugins-id]");t.on("open.zf.reveal",function(){let t=jQuery(this);if(void 0!==e[t.attr("acym-data-plugins-id")])return;let i=t.attr("acym-data-plugin-folder"),s=t.attr("acym-data-plugin-class");e[t.attr("acym-data-plugins-id")]=new Vue({el:"#"+t.attr("acym-data-plugins-id"),components:{"vue-prism-editor":VuePrismEditor},data:()=>({language:"html",code:"",saving:!1,saved:!1,messageSaved:"",deleting:!1,deleted:!1,messageDeleted:"",tags:[],optionIndent:{indent_size:2,wrap_line_length:"120"},loading:!0}),mounted(){let e=ACYM_AJAX_URL+"&ctrl=plugins&task=getCustomViewPlugin&plugin="+i+"&plugin_class="+s;this.setTags(),jQuery.get(e,e=>{if((e=acym_helper.parseJson(e)).error)return acym_helperNotification.addNotification(e.message,"error"),t.foundation("close"),!1;e.data.content=void 0===html_beautify?e.data.content:html_beautify(e.data.content,this.optionIndent),this.code=e.data.content,this.loading=!1})},methods:{save(){this.saving=!0;let e=ACYM_AJAX_URL+"&ctrl=plugins&task=saveCustomViewPlugin&plugin="+i;jQuery.post(e,{custom_view:encodeURIComponent(this.code)},e=>{e=acym_helper.parseJson(e),this.saving=!1,this.messageSaved=e.message,this.saved=!0,setTimeout(()=>{this.saved=!1},2e3)})},resetView(){if(!confirm(ACYM_JS_TXT.ACYM_RESET_VIEW_CONFIRM))return;this.deleting=!0;let e=ACYM_AJAX_URL+"&ctrl=plugins&task=deleteCustomViewPlugin&plugin="+i+"&plugin_class="+s;jQuery.post(e,e=>{if((e=acym_helper.parseJson(e)).error)return acym_helperNotification.addNotification(e.message,"error"),t.foundation("close"),!1;e.data.content=void 0===html_beautify?e.data.content:html_beautify(e.data.content,this.optionIndent),this.code=e.data.content,this.deleting=!1,this.messageDeleted=e.message,this.deleted=!0,setTimeout(()=>{this.deleted=!1},2e3)})},insertTag(e){e=`{${e}}`;let t=this.$children[0];if(void 0===t.selection||void 0===t.selection.start)return!1;this.code=`${this.code.slice(0,t.selection.start)}${e}${this.code.slice(t.selection.end)}`,t.selection.end!==t.selection.start&&(t.selection.end=t.selection.start+e.length),t.selection.end===t.selection.start&&(t.selection.start+=e.length,t.selection.end+=e.length)},setTags(){this.tags=acym_helper.parseJson(t.find("[acym-data-tags]").attr("acym-data-tags"));for(let[e,t]of Object.entries(this.tags))this.tags[e]=void 0===ACYM_JS_TXT[t[0]]?t[0]:ACYM_JS_TXT[t[0]]}}})}),t.on("closed.zf.reveal",function(){jQuery(document).trigger("acym_custom_view_modal_closed")})});