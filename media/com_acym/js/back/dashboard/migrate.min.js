jQuery(function(_){let e=0,a=0,t=0,i=0,c=500,s=50,m=10,r=2e3,l=0,n=0,o=0;function g(){let e=_("#acym__migrate__mails").is(":checked");e?_("#acym__migrate__input__global_stats").show():_("#acym__migrate__input__global_stats").hide(),_("#acym__migrate__mailstats").prop("disabled",!1===e),_("#acym__migrate__button").prop("disabled",0===_("input:checked").length)}function h(){_("#acym__migrate__no__button").prop("disabled",!0),_("#acym__migrate__button").prop("disabled",!0),_(".acym__migrate__option").prop("disabled",!0);const e={config:_("#acym__migrate__config").is(":checked")&&!_("#acym__migrate__config").hasClass("acym__migrate__migrate_with_success_element"),bounce:_("#acym__migrate__bounce").is(":checked")&&!_("#acym__migrate__bounce").hasClass("acym__migrate__migrate_with_success_element"),lists:_("#acym__migrate__lists").is(":checked")&&!_("#acym__migrate__lists").hasClass("acym__migrate__migrate_with_success_element"),mails:_("#acym__migrate__mails").is(":checked")&&!_("#acym__migrate__mails").hasClass("acym__migrate__migrate_with_success_element"),templates:_("#acym__migrate__templates").is(":checked")&&!_("#acym__migrate__templates").hasClass("acym__migrate__migrate_with_success_element"),fields:_("#acym__migrate__fields").is(":checked")&&!_("#acym__migrate__fields").hasClass("acym__migrate__migrate_with_success_element"),users:_("#acym__migrate__users").is(":checked")&&!_("#acym__migrate__users").hasClass("acym__migrate__migrate_with_success_element"),distrib:_("#acym__migrate__distrib").is(":checked")&&!_("#acym__migrate__distrib").hasClass("acym__migrate__migrate_with_success_element")};e.subscriptions=e.users&&e.lists,e.users_fields=e.users&&e.fields,e.mailstats=_("#acym__migrate__mailstats").is(":checked")&&!_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),e.mailhaslists=e.mails&&e.lists,e.welcomeunsub=e.mails&&e.lists;const a=[],t=[];_.each(e,function(_,e){if(!0===e){let e=ACYM_AJAX_URL+"&ctrl=dashboard&task=preMigration&element="+_;a.push(e),t.push(_)}}),_("#acym__migrate__all_checked_elements").val(JSON.stringify(t)),l=t.length,n=100/l,_(".acym__migration__need__display").show(),y(a,t)}function y(l,g){if(0===l.length)return _("#acym__migration__progress__bar__inner").animate({width:"100%"}),_("#acym__migration__percentage").html("100%"),void _("#acym__migrate__result__ok").show();let h=g.shift().toLowerCase();_("#acym__migrate__result__"+h+"__check").html('<i class="acymicon-circle-o-notch acymicon-spin acym__color__blue"></i>');let y=l.shift();_.post(y,function(y){if("0"==y)o+=n,_("#acym__migration__progress__bar__inner").animate({width:Math.round(o)+"%"}),_("#acym__migration__percentage").html(Math.round(o)+"%"),u(!1,h,l,g,y);else if(-1!==y.indexOf("ERROR"))u(!0,h,l,g,y);else{let d=c;"mails"===h&&(d=s),a=0,i=0,e=Math.ceil(y/(d*m)),t=Math.ceil(y/d),function l(g,h,y){let d=!1,f=[],p="",k=c;"mails"===g&&(k=s);for(let e=0;e<m&&!(i>t);e++){let e=i*k,a=_.post(ACYM_AJAX_URL+"&ctrl=dashboard&task=migrate&element="+g+"&currentElement="+e+"&insertPerCalls="+k);f.push(a),i++}return _.when.apply(_,f).then(function(){a++,o=n/e+o,_("#acym__migration__progress__bar__inner").animate({width:Math.round(o)+"%"}),_("#acym__migration__percentage").html(Math.round(o)+"%"),_.each(arguments,function(_,e){-1!==e[0].indexOf("ERROR")&&(d=!0,p=e[0],u(d,g,h,y,p))}),a===e?u(d,g,h,y,p):setTimeout(function(){l(g,h,y)},r)}),!0}(h,l,g)}}).fail(function(e){_("#acym__migrate__result").append("<br>"+ACYM_JS_TXT.ACYM_LOADING_ERROR)})}function u(e,a,t,i,c){e?(_("#acym__migrate__error_element").val(a),_("#acym__migrate__result__"+a+"__check").html('<i class="acymicon-exclamation-circle acym__color__red"></i>'),"mails"===a&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="acymicon-exclamation-circle acym__color__red"></i>'),_("#acym__migrate__result__error__message").html(c),_("#acym__migrate__result__error").show()):(_("#acym__migrate__result__"+a+"__check").html('<i class="acymicon-check-circle acym__color__green"></i>'),"mails"===a&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="acymicon-check-circle acym__color__green"></i>'),_("#acym__migrate__"+a).addClass("acym__migrate__migrate_with_success_element"),y(t,i))}_(".acym__migrate__option").off("change").on("change",function(){g(),_(".acym__migrate__option:disabled").prop("checked",!1)}),g(),_("#acym__migrate__button").off("click").on("click",function(){h()}),_("#acym__migrate__restart_from_error__button").off("click").on("click",function(){window.scrollTo(0,0),_("#acym__migrate__result__error").hide(),_("#acym__migrate__result__error__message").html(""),h()})});