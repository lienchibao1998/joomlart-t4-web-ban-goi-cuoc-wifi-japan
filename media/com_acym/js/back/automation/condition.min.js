jQuery(function(t){function o(){n("classic"),n("user"),t(".acym__automation__add-condition").off("click").on("click",function(){let n=t(this).closest(".acym__automation__group__condition").find(".acym__automation__one__condition").length;if(0===n){let o=t("#acym__automation__and__example").clone().removeAttr("id");o.find(".acym__automation__and").remove(),t(this).parent().before(o.show())}else t(this).parent().before(t("#acym__automation__and__example").clone().removeAttr("id").show());let a=t(this).parent().prev();a.addClass("acym__automation__one__condition__"+t(this).attr("data-condition-type")),a.find(".acym__automation__and__example__"+t(this).attr("data-condition-type")+"__select").show().find("select").addClass("acym__select").select2({theme:"foundation",width:"100%"}),o()}),t(".acym__automation__choose__condition").off("click").on("click",function(){t("#acym__automation__type-condition__input").val(t(this).attr("data-condition")),t(".selected-condition").removeClass("selected-condition"),t(this).addClass("selected-condition");let o=t(".acym__automation__condition__container");o.hide(),o.find('[name^="type_condition"]').each(function(o){t(this).attr("name",t(this).attr("name").replace("type_condition",""))});let n=t("#acym__automation__conditions__type__"+t(this).attr("data-condition"));n.show(),n.find('[name^="[conditions]"]').each(function(o){t(this).attr("name","type_condition"+t(this).attr("name"))})}),t(".acym__automation__conditions__or").off("click").on("click",function(){let n=t("#acym__automation__conditions__count__or");n.val(parseInt(n.val())+1),t(this).before(t("#acym__automation__or__example").html());let a=t(this).prev();a.attr("data-condition-number",n.val()),o(),a.find("button[data-condition-type]").attr("data-condition-type",t(this).attr("data-condition-type")).trigger("click")}),t(".acym__automation__delete__one__condition").off("click").on("click",function(){t(this).closest(".acym__automation__one__condition").remove()}),t(".acym__automation__delete__group__condition").off("click").on("click",function(){let o=t(this).closest(".acym__automation__group__condition");o.prev().remove(),o.remove()}),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSelect2.setAjaxSelect2(),acym_helperFilter.setAutomationReload()}function n(n){let a=t("#acym__automation__condition__"+n+"__options");if(!a.length)return;let i=acym_helper.parseJson(a.val());t(".acym__automation__select__"+n+"__condition").off("change").on("change",function(){let n=t("#acym__automation__conditions__count__and");n.val(parseInt(n.val())+1),t(this).parent().parent().find(".acym__automation__inserted__condition").remove();let a=i[t(this).val()].replace(/__numor__/g,t(this).closest(".acym__automation__group__condition").attr("data-condition-number"));a=a.replace(/__numand__/g,n.val()),t(this).parent().after('<div data-and="'+n.val()+'" class="cell grid-x grid-margin-x margin-y acym__automation__inserted__condition margin-top-1 margin-left-2">'+a+"</div>"),acym_helperSelect2.setSelect2(),acym_helperDatePicker.setDatePickerGlobal(),acym_helperTooltip.setTooltip(),t(".switch-label").off("click").on("click",function(){let o=t('input[data-switch="'+t(this).attr("for")+'"]');o.attr("value",1-o.attr("value"))});let _=t(this).closest(".acym__automation__one__condition").find(".acym__automation__conditions__operator__dropdown"),e=t(this).closest(".acym__automation__one__condition").find(".acym__automation__conditions__fields__dropdown");_.on("change",function(){e.trigger("change")}),e.on("change",function(){let o=t(this).closest(".acym__automation__inserted__condition"),n=o.find('[data-condition-field="'+t(this).val()+'"]'),a=o.find(".acym__automation__conditions__fields__select"),i=o.find(".acym__automation__condition__regular-field");n.length>0&&("="===_.val()||"!="===_.val())?(i.attr("name",i.attr("name").replace("acym_condition","")).hide(),a.each(function(o){t(this).attr("name",t(this).attr("name").replace("acym_condition","")),t(this).closest(".acym__automation__one-field").hide()}),-1===n.attr("name").indexOf("acym_condition")&&n.attr("name","acym_condition"+n.attr("name")),n.closest(".acym__automation__one-field").show()):(-1===i.attr("name").indexOf("acym_condition")&&i.attr("name","acym_condition"+i.attr("name")),a.length>0&&a.each(function(){t(this).attr("name",t(this).attr("name").replace("acym_condition","")),t(this).closest(".acym__automation__one-field").hide()}),i.show())}).trigger("change"),t(document).foundation(),t(".reveal-overlay").appendTo("#acym_form"),o()})}o(),function(){let n=t("#conditions");if(!n.length)return;let a=acym_helper.parseJson(n.val()),i=a.type_condition,_=0;t.each(a,function(o,n){let a=0;if("type_condition"===o)return!0;0!==_&&t('.acym__automation__conditions__or[data-condition-type="'+i+'"]').trigger("click"),t.each(n,function(o,n){0!==a&&t('.acym__automation__group__condition[data-condition-number="'+_+'"]').find('.acym__automation__add-condition[data-condition-type="'+i+'"]').trigger("click"),t.each(n,function(o,n){let a=t('.acym__automation__group__condition[data-condition-number="'+_+'"]').find(".acym__automation__select__"+i+"__condition").last();a.val(o),a.trigger("change");let e=Object.keys(n);t.each(e,function(a){let i=e[a],c=n[e[a]],d=t('[name="acym_condition[conditions]['+_+"]["+t("#acym__automation__conditions__count__and").val()+"]["+o+"]["+i+']"]');acym_helperFilter.setFieldValue(d,c),d.trigger("change")})}),a++}),_++}),o()}(),t.cleanCondition=function(){const o={};t(".acym__automation__choose__condition").each((n,a)=>{o[a.getAttribute("data-condition")]=t(`#acym__automation__conditions__type__${a.getAttribute("data-condition")}`)});const n=t(".acym__automation__choose__condition:not(.selected-condition)").attr("data-condition");return t(o[n]).find('[name^="acym_condition"]').remove(),!0}});