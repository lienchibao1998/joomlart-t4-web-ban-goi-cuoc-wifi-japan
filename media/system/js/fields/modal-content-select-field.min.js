import g from"joomla.dialog";/**
 * @copyright  (C) 2023 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */const m=(e,t,o)=>{const a=`${e.id||e.value||""}`,n=t.value!==a;t.value=a,o&&(o.value=e.title||t.value),n&&t.dispatchEvent(new CustomEvent("change",{bubbles:!0,cancelable:!0}))},w=(e,t,o)=>{window.JoomlaExpectingPostMessage=!0;const a=new g(o);return a.classList.add("joomla-dialog-content-select-field"),a.show(),new Promise(n=>{const d=s=>{s.origin===window.location.origin&&(s.data.messageType==="joomla:content-select"?(m(s.data,e,t),a.close()):s.data.messageType==="joomla:cancel"&&a.close())};a.addEventListener("joomla-dialog:close",()=>{delete window.JoomlaExpectingPostMessage,window.removeEventListener("message",d),a.destroy(),n()}),window.addEventListener("message",d)})},f=(e,t)=>{const o=!!e.value;t.querySelectorAll("[data-show-when-value]").forEach(a=>{a.dataset.showWhenValue?o?a.removeAttribute("hidden"):a.setAttribute("hidden",""):o?a.setAttribute("hidden",""):a.removeAttribute("hidden")})},v=e=>{const t=e?e.querySelector(".js-input-value"):null,o=e?e.querySelector(".js-input-title"):null;if(!e||!t)throw new Error("Incomplete markup of Content dialog field");e.addEventListener("change",()=>{f(t,e)}),e.addEventListener("click",a=>{const n=a.target.closest("[data-button-action]");if(!n)return;a.preventDefault();const d=n.dataset.buttonAction,s=n.dataset.modalConfig?JSON.parse(n.dataset.modalConfig):{},u=e.dataset.keyName||"id";let i;switch(d){case"select":case"create":i=w(t,o,s);break;case"edit":{const l=s.src.indexOf("http")===0?new URL(s.src):new URL(s.src,window.location.origin);l.searchParams.set(u,t.value),s.src=l.toString(),i=w(t,o,s);break}case"clear":i=(async()=>m({id:"",title:""},t,o))();break;default:throw new Error(`Unknown action ${d} for Modal select field`)}i.then(()=>{if(n.dataset.checkinUrl){const l=n.dataset.checkinUrl,c=l.indexOf("http")===0?new URL(l):new URL(l,window.location.origin);c.searchParams.set(u,t.value),c.searchParams.set("cid[]",t.value);const r=new FormData;r.append("id",t.value),r.append("cid[]",t.value),Joomla.request({url:c.toString(),method:"POST",promise:!0,data:r})}})})},h=e=>{e.querySelectorAll(".js-modal-content-select-field").forEach(t=>v(t))};document.addEventListener("DOMContentLoaded",()=>h(document)),document.addEventListener("joomla:updated",e=>h(e.target));
