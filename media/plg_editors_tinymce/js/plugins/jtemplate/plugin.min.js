(function(){"use strict";var L=tinymce.util.Tools.resolve("tinymce.PluginManager");const E=(t,e,n)=>{var s;return n(t,e.prototype)?!0:((s=t.constructor)===null||s===void 0?void 0:s.name)===e.name},F=t=>{const e=typeof t;return t===null?"null":e==="object"&&Array.isArray(t)?"array":e==="object"&&E(t,String,(n,s)=>s.isPrototypeOf(n))?"string":e},C=t=>e=>F(e)===t,$=t=>e=>typeof e===t,w=C("string"),H=C("object"),k=C("array"),B=t=>t==null,J=t=>!B(t),b=$("function"),U=(t,e)=>{if(k(t)){for(let n=0,s=t.length;n<s;++n)if(!e(t[n]))return!1;return!0}return!1},Y=t=>()=>t;function R(t,...e){return(...n)=>{const s=e.concat(n);return t.apply(null,s)}}const K=Y(!1),V=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");var y=tinymce.util.Tools.resolve("tinymce.util.Tools");const g=t=>e=>e.options.get(t),z=t=>{const e=t.options.register;e("template_cdate_classes",{processor:"string",default:"cdate"}),e("template_mdate_classes",{processor:"string",default:"mdate"}),e("template_selected_content_classes",{processor:"string",default:"selcontent"}),e("template_preview_replace_values",{processor:"object"}),e("template_replace_values",{processor:"object"}),e("jtemplates",{processor:n=>w(n)||U(n,H)||b(n),default:[]}),e("template_cdate_format",{processor:"string",default:t.translate("%Y-%m-%d")}),e("template_mdate_format",{processor:"string",default:t.translate("%Y-%m-%d")})},W=g("template_cdate_classes"),x=g("template_mdate_classes"),q=g("template_selected_content_classes"),Z=g("template_preview_replace_values"),D=g("template_replace_values"),G=g("jtemplates"),Q=g("template_cdate_format"),A=g("template_mdate_format"),X=g("content_style"),ee=g("content_css_cors"),te=g("body_class"),v=(t,e)=>{if(t=""+t,t.length<e)for(let n=0;n<e-t.length;n++)t="0"+t;return t},S=(t,e,n=new Date)=>{const s="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),r="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),l="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),u="January February March April May June July August September October November December".split(" ");return e=e.replace("%D","%m/%d/%Y"),e=e.replace("%r","%I:%M:%S %p"),e=e.replace("%Y",""+n.getFullYear()),e=e.replace("%y",""+n.getYear()),e=e.replace("%m",v(n.getMonth()+1,2)),e=e.replace("%d",v(n.getDate(),2)),e=e.replace("%H",""+v(n.getHours(),2)),e=e.replace("%M",""+v(n.getMinutes(),2)),e=e.replace("%S",""+v(n.getSeconds(),2)),e=e.replace("%I",""+((n.getHours()+11)%12+1)),e=e.replace("%p",n.getHours()<12?"AM":"PM"),e=e.replace("%B",""+t.translate(u[n.getMonth()])),e=e.replace("%b",""+t.translate(l[n.getMonth()])),e=e.replace("%A",""+t.translate(r[n.getDay()])),e=e.replace("%a",""+t.translate(s[n.getDay()])),e=e.replace("%%","%"),e};class o{constructor(e,n){this.tag=e,this.value=n}static some(e){return new o(!0,e)}static none(){return o.singletonNone}fold(e,n){return this.tag?n(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?o.some(e(this.value)):o.none()}bind(e){return this.tag?e(this.value):o.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:o.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e??"Called getOrDie on None")}static from(e){return J(e)?o.some(e):o.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}o.singletonNone=new o(!1);const ne=(t,e)=>{for(let n=0,s=t.length;n<s;n++){const r=t[n];if(e(r,n))return!0}return!1},se=(t,e)=>{const n=t.length,s=new Array(n);for(let r=0;r<n;r++){const l=t[r];s[r]=e(l,r)}return s},ae=(t,e,n)=>{for(let s=0,r=t.length;s<r;s++){const l=t[s];if(e(l,s))return o.some(l);if(n(l,s))break}return o.none()},re=(t,e)=>ae(t,e,K),le=Object.hasOwnProperty,oe=(t,e)=>ce(t,e)?o.from(t[e]):o.none(),ce=(t,e)=>le.call(t,e);var ie=tinymce.util.Tools.resolve("tinymce.html.Serializer");const ue={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},pe=t=>t.replace(/["'<>&]/g,e=>oe(ue,e).getOr(e)),T=(t,e,n)=>ne(n.split(/\s+/),s=>t.hasClass(e,s)),P=(t,e)=>ie({validate:!0},t.schema).serialize(t.parser.parse(e,{insert:!0})),ge=(t,e)=>()=>{const n=G(t);b(n)?n(e):w(n)?fetch(n).then(s=>{s.ok&&s.json().then(e)}):e(n)},O=(t,e)=>(y.each(e,(n,s)=>{b(n)&&(n=n(s)),t=t.replace(new RegExp("\\{\\$"+V(s)+"\\}","g"),n)}),t),I=(t,e)=>{const n=t.dom,s=D(t);y.each(n.select("*",e),r=>{y.each(s,(l,u)=>{n.hasClass(r,u)&&b(l)&&l(r)})})},me=(t,e,n)=>{const s=t.dom,r=t.selection.getContent();n=O(n,D(t));let l=s.create("div",{},P(t,n));const u=s.select(".mceTmpl",l);u&&u.length>0&&(l=s.create("div"),l.appendChild(u[0].cloneNode(!0))),y.each(s.select("*",l),p=>{T(s,p,W(t))&&(p.innerHTML=S(t,Q(t))),T(s,p,x(t))&&(p.innerHTML=S(t,A(t))),T(s,p,q(t))&&(p.innerHTML=r)}),I(t,l),t.execCommand("mceInsertContent",!1,l.innerHTML),t.addVisual()};var j=tinymce.util.Tools.resolve("tinymce.Env");const he=(t,e)=>{var n;if(e.indexOf("<html>")===-1){let s="";const r=(n=X(t))!==null&&n!==void 0?n:"",l=ee(t)?' crossorigin="anonymous"':"";y.each(t.contentCSS,c=>{s+='<link type="text/css" rel="stylesheet" href="'+t.documentBaseURI.toAbsolute(c)+'"'+l+">"}),r&&(s+='<style type="text/css">'+r+"</style>");const u=te(t),p=t.dom.encode,_='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+(j.os.isMacOS()||j.os.isiOS()?"e.metaKey":"e.ctrlKey && !e.altKey")+")) {e.preventDefault();}}}, false);<\/script> ",M=t.getBody().dir,a=M?' dir="'+p(M)+'"':"";e='<!DOCTYPE html><html><head><base href="'+p(t.documentBaseURI.getURI())+'">'+s+_+'</head><body class="'+p(u)+'"'+a+">"+P(t,e)+"</body></html>"}return O(e,Z(t))},de=(t,e)=>{const n=()=>{if(!e||e.length===0){const a=t.translate("No templates defined.");return t.notificationManager.open({text:a,type:"info"}),o.none()}return o.from(y.map(e,(a,c)=>{const i=h=>h.url!==void 0;return{selected:c===0,text:a.title,value:{url:i(a)?o.from(a.url):o.none(),content:i(a)?o.none():o.from(a.content),description:a.description}}}))},s=a=>se(a,c=>({text:c.text,value:c.text})),r=(a,c)=>re(a,i=>i.text===c),l=a=>{t.windowManager.alert("Could not load the specified template.",()=>a.focus("template"))},u=a=>a.value.url.fold(()=>Promise.resolve(a.value.content.getOr("")),c=>fetch(c).then(i=>i.ok?i.text():Promise.reject())),p=(a,c)=>(i,h)=>{if(h.name==="template"){const d=i.getData().template;r(a,d).each(m=>{i.block("Loading..."),u(m).then(f=>{c(i,m,f)}).catch(()=>{c(i,m,""),i.setEnabled("save",!1),l(i)})})}},N=a=>c=>{const i=c.getData();r(a,i.template).each(h=>{u(h).then(d=>{t.execCommand("mceInsertTemplate",!1,d),c.close()}).catch(()=>{c.setEnabled("save",!1),l(c)})})},_=a=>{const c=s(a),i=(m,f)=>({title:"Insert Template",size:"large",body:{type:"panel",items:m},initialData:f,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:N(a),onChange:p(a,h)}),h=(m,f,Ce)=>{const Se=he(t,Ce),_e=[{type:"selectbox",name:"template",label:"Templates",items:c},{type:"htmlpanel",html:`<p aria-live="polite">${pe(f.value.description)}</p>`},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1,transparent:!1}],Me={template:f.text,preview:Se};m.unblock(),m.redial(i(_e,Me)),m.focus("template")},d=t.windowManager.open(i([],{template:"",preview:""}));d.block("Loading..."),u(a[0]).then(m=>{h(d,a[0],m)}).catch(()=>{h(d,a[0],""),d.setEnabled("save",!1),l(d)})};n().each(_)},ye=t=>e=>{de(t,e)},fe=t=>{t.addCommand("mceInsertTemplate",R(me,t)),t.addCommand("mceTemplate",ge(t,ye(t)))},ve=t=>{t.on("PreProcess",e=>{const n=t.dom,s=A(t);y.each(n.select("div",e.node),r=>{n.hasClass(r,"mceTmpl")&&(y.each(n.select("*",r),l=>{T(n,l,x(t))&&(l.innerHTML=S(t,s))}),I(t,r))})})},be=t=>{const e=()=>t.execCommand("mceTemplate");t.ui.registry.addButton("jtemplate",{icon:"template",tooltip:"Insert template",onAction:e}),t.ui.registry.addMenuItem("jtemplate",{icon:"template",text:"Insert template...",onAction:e})};var Te=()=>{L.add("jtemplate",t=>(z(t),be(t),fe(t),ve(t),{getMetadata:()=>({name:"Template (Joomla)",url:"https://www.joomla.org/"})}))};Te()})();
