function readFile(e,n){const l=new FileReader;l.onload=d=>{const{result:t}=d.target,o=t.indexOf("base64")+7,a=t.slice(o,t.length);n(e.name,a)},l.readAsDataURL(e)}window.tinymce.PluginManager.add("jdragndrop",e=>{const n=e.options.register;n("uploadUri",{processor:"string"}),n("comMediaAdapter",{processor:"string"}),n("parentUploadFolder",{processor:"string"}),n("csrfToken",{processor:"string"});const l=t=>{t.dataTransfer.types.includes("Files")&&(t.stopPropagation(),t.preventDefault(),e.contentAreaContainer.style.borderWidth="0")};window.tinyMCE.DOM.bind(document,"dragleave",l),e.on("remove",()=>window.tinyMCE.DOM.unbind(document,"dragleave",l)),e.on("dragenter",t=>{t.dataTransfer.types.includes("Files")&&t.stopPropagation()}),e.on("dragover",t=>{t.dataTransfer.types.includes("Files")&&(t.preventDefault(),e.contentAreaContainer.style.borderStyle="dashed",e.contentAreaContainer.style.borderWidth="5px")});async function d(t,o){const a=e.options.get;Joomla.request({url:`${a("uploadUri")}&path=${a("comMediaAdapter")}${a("parentUploadFolder")}`,method:"POST",data:JSON.stringify({[a("csrfToken")]:1,name:t,content:o,parent:a("parentUploadFolder")}),headers:{"Content-Type":"application/json"},onSuccess:c=>{let i;try{i=JSON.parse(c)}catch(r){e.windowManager.alert(`${Joomla.Text._("ERROR")}: {${r}}`)}if(i.data&&i.data.path){const r=i.data;let g;const y=Joomla.getOptions("system.paths"),{rootFull:T}=y,u=i.data.url.split(T);u.length>1?g=`${u[1]}`:r.url&&(g=r.url);const m=function(f){const s=f.getData(),h=s.altEmpty?' alt=""':"",D=s.altText?` alt="${s.altText}"`:h,w=s.isLazy?' loading="lazy"':"",b=s.isLazy?` width="${r.width}"`:"",x=s.isLazy?` height="${r.height}"`:"";e.execCommand("mceInsertContent",!1,`<img src="${g}"${D}${w}${b}${x}/>`)};e.windowManager.open({title:Joomla.Text._("PLG_TINY_DND_ADDITIONALDATA"),body:{type:"panel",items:[{type:"input",name:"altText",label:Joomla.Text._("PLG_TINY_DND_ALTTEXT")},{type:"checkbox",name:"altEmpty",label:Joomla.Text._("PLG_TINY_DND_EMPTY_ALT")},{type:"checkbox",name:"isLazy",label:Joomla.Text._("PLG_TINY_DND_LAZYLOADED")}]},buttons:[{type:"cancel",text:"Cancel"},{type:"submit",name:"submitButton",text:"Save",primary:!0}],initialData:{altText:"",isLazy:!0,altEmpty:!1},onSubmit:p=>{m(p),p.close()},onCancel:p=>m(p)})}},onError:c=>e.windowManager.alert(`Error: ${c.statusText}`)})}return e.on("drop",t=>{t.dataTransfer.types.includes("Files")&&(t.preventDefault(),t.dataTransfer.files.length>0&&Array.from(t.dataTransfer.files).forEach(o=>{o.name.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp)$/)&&readFile(o,d)}),e.contentAreaContainer.style.borderWidth="0")}),{getMetadata:()=>({name:"Drag and Drop (Joomla)",url:"https://www.joomla.org/"})}});
